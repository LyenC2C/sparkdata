hive<<EOF
-- use wlbase_dev;
-- drop table wlbase_dev.t_base_user_profile_telindex;
-- create table wlbase_dev.t_base_user_profile_telindex as
-- select
-- t1.tel,
-- t2.*
-- from
-- t_zlj_phone_rank_index t1
-- join
-- t_base_user_profile t2
-- on
-- t1.tb_id = t2.tb_id
-- and
-- t1.rn = 1
-- ;
--20161216版本，计算20160700的特征

drop table wlservice.t_wrt_model_rong360_avgprice_tmp1; --算平均价格
create table wlservice.t_wrt_model_rong360_avgprice_tmp1 as
select
a.tel,
a.root_cat_id,
a.root_cat_name,
c.price as cat_avg_price,
round(sum(a.price),2) as price,
count(*) as cnt,
round(sum(a.price)/count(*),2) as avg_price,
round(sum(a.price)/count(*),2)/c.price as price_ratio
from wlservice.t_zlj_tmp_rong360_1w_record  a
left join wlbase_dev.t_root_cat_avg_price c on a.root_cat_id=c.root_cat_id
where c.price is not null and a.rn<4 and a.price<59999 and a.dsn >'20160700'
group by a.tel,a.root_cat_id,a.root_cat_name,c.price;


drop table wlservice.t_wrt_model_rong360_purchase_power;
create table wlservice.t_wrt_model_rong360_purchase_power as
select
tel,
avg(price_ratio) as avg_price_ratio,
std(price_ratio) as std_price_ratio
from wlservice.t_wrt_model_rong360_avgprice_tmp1
group by tel;


drop table wlservice.t_wrt_model_rong360_cnt_raio;
create table wlservice.t_wrt_model_rong360_cnt_raio as
select
tel,
sum(if (root_cat_id=11,1,0)) as cnt_ratio_11,
sum(if (root_cat_id=1101,1,0)) as cnt_ratio_1101,
sum(if (root_cat_id=1201,1,0)) as cnt_ratio_1201,
sum(if (root_cat_id=120886001,1,0)) as cnt_ratio_120886001,
sum(if (root_cat_id=120950002,1,0)) as cnt_ratio_120950002,
sum(if (root_cat_id=121266001,1,0)) as cnt_ratio_121266001,
sum(if (root_cat_id=121536003,1,0)) as cnt_ratio_121536003,
sum(if (root_cat_id=121536007,1,0)) as cnt_ratio_121536007,
sum(if (root_cat_id=122650005,1,0)) as cnt_ratio_122650005,
sum(if (root_cat_id=122684003,1,0)) as cnt_ratio_122684003,
sum(if (root_cat_id=122718004,1,0)) as cnt_ratio_122718004,
sum(if (root_cat_id=122852001,1,0)) as cnt_ratio_122852001,
sum(if (root_cat_id=122928002,1,0)) as cnt_ratio_122928002,
sum(if (root_cat_id=122950001,1,0)) as cnt_ratio_122950001,
sum(if (root_cat_id=122952001,1,0)) as cnt_ratio_122952001,
sum(if (root_cat_id=124024001,1,0)) as cnt_ratio_124024001,
sum(if (root_cat_id=124044001,1,0)) as cnt_ratio_124044001,
sum(if (root_cat_id=124050001,1,0)) as cnt_ratio_124050001,
sum(if (root_cat_id=124242008,1,0)) as cnt_ratio_124242008,
sum(if (root_cat_id=124354002,1,0)) as cnt_ratio_124354002,
sum(if (root_cat_id=124458005,1,0)) as cnt_ratio_124458005,
sum(if (root_cat_id=124466001,1,0)) as cnt_ratio_124466001,
sum(if (root_cat_id=124468001,1,0)) as cnt_ratio_124468001,
sum(if (root_cat_id=124470001,1,0)) as cnt_ratio_124470001,
sum(if (root_cat_id=124484008,1,0)) as cnt_ratio_124484008,
sum(if (root_cat_id=124750013,1,0)) as cnt_ratio_124750013,
sum(if (root_cat_id=14,1,0)) as cnt_ratio_14,
sum(if (root_cat_id=1512,1,0)) as cnt_ratio_1512,
sum(if (root_cat_id=16,1,0)) as cnt_ratio_16,
sum(if (root_cat_id=1625,1,0)) as cnt_ratio_1625,
sum(if (root_cat_id=1801,1,0)) as cnt_ratio_1801,
sum(if (root_cat_id=20,1,0)) as cnt_ratio_20,
sum(if (root_cat_id=21,1,0)) as cnt_ratio_21,
sum(if (root_cat_id=23,1,0)) as cnt_ratio_23,
sum(if (root_cat_id=25,1,0)) as cnt_ratio_25,
sum(if (root_cat_id=26,1,0)) as cnt_ratio_26,
sum(if (root_cat_id=27,1,0)) as cnt_ratio_27,
sum(if (root_cat_id=28,1,0)) as cnt_ratio_28,
sum(if (root_cat_id=2813,1,0)) as cnt_ratio_2813,
sum(if (root_cat_id=29,1,0)) as cnt_ratio_29,
sum(if (root_cat_id=30,1,0)) as cnt_ratio_30,
sum(if (root_cat_id=33,1,0)) as cnt_ratio_33,
sum(if (root_cat_id=34,1,0)) as cnt_ratio_34,
sum(if (root_cat_id=35,1,0)) as cnt_ratio_35,
sum(if (root_cat_id=40,1,0)) as cnt_ratio_40,
sum(if (root_cat_id=50002766,1,0)) as cnt_ratio_50002766,
sum(if (root_cat_id=50002768,1,0)) as cnt_ratio_50002768,
sum(if (root_cat_id=50004958,1,0)) as cnt_ratio_50004958,
sum(if (root_cat_id=50006842,1,0)) as cnt_ratio_50006842,
sum(if (root_cat_id=50006843,1,0)) as cnt_ratio_50006843,
sum(if (root_cat_id=50007216,1,0)) as cnt_ratio_50007216,
sum(if (root_cat_id=50007218,1,0)) as cnt_ratio_50007218,
sum(if (root_cat_id=50008075,1,0)) as cnt_ratio_50008075,
sum(if (root_cat_id=50008090,1,0)) as cnt_ratio_50008090,
sum(if (root_cat_id=50008141,1,0)) as cnt_ratio_50008141,
sum(if (root_cat_id=50008163,1,0)) as cnt_ratio_50008163,
sum(if (root_cat_id=50008164,1,0)) as cnt_ratio_50008164,
sum(if (root_cat_id=50008165,1,0)) as cnt_ratio_50008165,
sum(if (root_cat_id=50008907,1,0)) as cnt_ratio_50008907,
sum(if (root_cat_id=50010404,1,0)) as cnt_ratio_50010404,
sum(if (root_cat_id=50010728,1,0)) as cnt_ratio_50010728,
sum(if (root_cat_id=50010788,1,0)) as cnt_ratio_50010788,
sum(if (root_cat_id=50011397,1,0)) as cnt_ratio_50011397,
sum(if (root_cat_id=50011665,1,0)) as cnt_ratio_50011665,
sum(if (root_cat_id=50011699,1,0)) as cnt_ratio_50011699,
sum(if (root_cat_id=50011740,1,0)) as cnt_ratio_50011740,
sum(if (root_cat_id=50011949,1,0)) as cnt_ratio_50011949,
sum(if (root_cat_id=50011972,1,0)) as cnt_ratio_50011972,
sum(if (root_cat_id=50012029,1,0)) as cnt_ratio_50012029,
sum(if (root_cat_id=50012082,1,0)) as cnt_ratio_50012082,
sum(if (root_cat_id=50012100,1,0)) as cnt_ratio_50012100,
sum(if (root_cat_id=50012164,1,0)) as cnt_ratio_50012164,
sum(if (root_cat_id=50013864,1,0)) as cnt_ratio_50013864,
sum(if (root_cat_id=50013886,1,0)) as cnt_ratio_50013886,
sum(if (root_cat_id=50014811,1,0)) as cnt_ratio_50014811,
sum(if (root_cat_id=50014812,1,0)) as cnt_ratio_50014812,
sum(if (root_cat_id=50014927,1,0)) as cnt_ratio_50014927,
sum(if (root_cat_id=50016348,1,0)) as cnt_ratio_50016348,
sum(if (root_cat_id=50016349,1,0)) as cnt_ratio_50016349,
sum(if (root_cat_id=50016422,1,0)) as cnt_ratio_50016422,
sum(if (root_cat_id=50016891,1,0)) as cnt_ratio_50016891,
sum(if (root_cat_id=50017300,1,0)) as cnt_ratio_50017300,
sum(if (root_cat_id=50018004,1,0)) as cnt_ratio_50018004,
sum(if (root_cat_id=50018222,1,0)) as cnt_ratio_50018222,
sum(if (root_cat_id=50018264,1,0)) as cnt_ratio_50018264,
sum(if (root_cat_id=50019095,1,0)) as cnt_ratio_50019095,
sum(if (root_cat_id=50019780,1,0)) as cnt_ratio_50019780,
sum(if (root_cat_id=50020275,1,0)) as cnt_ratio_50020275,
sum(if (root_cat_id=50020332,1,0)) as cnt_ratio_50020332,
sum(if (root_cat_id=50020485,1,0)) as cnt_ratio_50020485,
sum(if (root_cat_id=50020579,1,0)) as cnt_ratio_50020579,
sum(if (root_cat_id=50020611,1,0)) as cnt_ratio_50020611,
sum(if (root_cat_id=50020808,1,0)) as cnt_ratio_50020808,
sum(if (root_cat_id=50020857,1,0)) as cnt_ratio_50020857,
sum(if (root_cat_id=50022517,1,0)) as cnt_ratio_50022517,
sum(if (root_cat_id=50022703,1,0)) as cnt_ratio_50022703,
sum(if (root_cat_id=50023282,1,0)) as cnt_ratio_50023282,
sum(if (root_cat_id=50023575,1,0)) as cnt_ratio_50023575,
sum(if (root_cat_id=50023717,1,0)) as cnt_ratio_50023717,
sum(if (root_cat_id=50023722,1,0)) as cnt_ratio_50023722,
sum(if (root_cat_id=50023724,1,0)) as cnt_ratio_50023724,
sum(if (root_cat_id=50023804,1,0)) as cnt_ratio_50023804,
sum(if (root_cat_id=50023878,1,0)) as cnt_ratio_50023878,
sum(if (root_cat_id=50023904,1,0)) as cnt_ratio_50023904,
sum(if (root_cat_id=50024451,1,0)) as cnt_ratio_50024451,
sum(if (root_cat_id=50024612,1,0)) as cnt_ratio_50024612,
sum(if (root_cat_id=50024971,1,0)) as cnt_ratio_50024971,
sum(if (root_cat_id=50025004,1,0)) as cnt_ratio_50025004,
sum(if (root_cat_id=50025110,1,0)) as cnt_ratio_50025110,
sum(if (root_cat_id=50025111,1,0)) as cnt_ratio_50025111,
sum(if (root_cat_id=50025705,1,0)) as cnt_ratio_50025705,
sum(if (root_cat_id=50025707,1,0)) as cnt_ratio_50025707,
sum(if (root_cat_id=50026316,1,0)) as cnt_ratio_50026316,
sum(if (root_cat_id=50026523,1,0)) as cnt_ratio_50026523,
sum(if (root_cat_id=50026555,1,0)) as cnt_ratio_50026555,
sum(if (root_cat_id=50026800,1,0)) as cnt_ratio_50026800,
sum(if (root_cat_id=50050359,1,0)) as cnt_ratio_50050359,
sum(if (root_cat_id=50050471,1,0)) as cnt_ratio_50050471,
sum(if (root_cat_id=50074001,1,0)) as cnt_ratio_50074001,
sum(if (root_cat_id=50158001,1,0)) as cnt_ratio_50158001,
sum(if (root_cat_id=50454031,1,0)) as cnt_ratio_50454031,
sum(if (root_cat_id=50468001,1,0)) as cnt_ratio_50468001,
sum(if (root_cat_id=50510002,1,0)) as cnt_ratio_50510002,
sum(if (root_cat_id=99,1,0)) as cnt_ratio_99
from wlservice.t_zlj_tmp_rong360_1w_record 
where rn<4 and price<59999
group by tel;



drop table  wlservice.t_wrt_model_rong360_price_raio;
create table wlservice.t_wrt_model_rong360_price_raio as
select
tel,
std(if (root_cat_id=11,price,NULL))       *avg(if (root_cat_id=11,price,NULL))        as price_ratio_11,
std(if (root_cat_id=1101,price,NULL))     *avg(if (root_cat_id=1101,price,NULL))      as price_ratio_1101,
std(if (root_cat_id=1201,price,NULL))     *avg(if (root_cat_id=1201,price,NULL))      as price_ratio_1201,
std(if (root_cat_id=120886001,price,NULL))*avg(if (root_cat_id=120886001,price,NULL))  as price_ratio_120886001,
std(if (root_cat_id=120950002,price,NULL))*avg(if (root_cat_id=120950002,price,NULL))  as price_ratio_120950002,
std(if (root_cat_id=121266001,price,NULL))*avg(if (root_cat_id=121266001,price,NULL))  as price_ratio_121266001,
std(if (root_cat_id=121536003,price,NULL))*avg(if (root_cat_id=121536003,price,NULL))  as price_ratio_121536003,
std(if (root_cat_id=121536007,price,NULL))*avg(if (root_cat_id=121536007,price,NULL))  as price_ratio_121536007,
std(if (root_cat_id=122650005,price,NULL))*avg(if (root_cat_id=122650005,price,NULL))  as price_ratio_122650005,
std(if (root_cat_id=122684003,price,NULL))*avg(if (root_cat_id=122684003,price,NULL))  as price_ratio_122684003,
std(if (root_cat_id=122718004,price,NULL))*avg(if (root_cat_id=122718004,price,NULL))  as price_ratio_122718004,
std(if (root_cat_id=122852001,price,NULL))*avg(if (root_cat_id=122852001,price,NULL))  as price_ratio_122852001,
std(if (root_cat_id=122928002,price,NULL))*avg(if (root_cat_id=122928002,price,NULL))  as price_ratio_122928002,
std(if (root_cat_id=122950001,price,NULL))*avg(if (root_cat_id=122950001,price,NULL))  as price_ratio_122950001,
std(if (root_cat_id=122952001,price,NULL))*avg(if (root_cat_id=122952001,price,NULL))  as price_ratio_122952001,
std(if (root_cat_id=124024001,price,NULL))*avg(if (root_cat_id=124024001,price,NULL))  as price_ratio_124024001,
std(if (root_cat_id=124044001,price,NULL))*avg(if (root_cat_id=124044001,price,NULL))  as price_ratio_124044001,
std(if (root_cat_id=124050001,price,NULL))*avg(if (root_cat_id=124050001,price,NULL))  as price_ratio_124050001,
std(if (root_cat_id=124242008,price,NULL))*avg(if (root_cat_id=124242008,price,NULL))  as price_ratio_124242008,
std(if (root_cat_id=124354002,price,NULL))*avg(if (root_cat_id=124354002,price,NULL))  as price_ratio_124354002,
std(if (root_cat_id=124458005,price,NULL))*avg(if (root_cat_id=124458005,price,NULL))  as price_ratio_124458005,
std(if (root_cat_id=124466001,price,NULL))*avg(if (root_cat_id=124466001,price,NULL))  as price_ratio_124466001,
std(if (root_cat_id=124468001,price,NULL))*avg(if (root_cat_id=124468001,price,NULL))  as price_ratio_124468001,
std(if (root_cat_id=124470001,price,NULL))*avg(if (root_cat_id=124470001,price,NULL))  as price_ratio_124470001,
std(if (root_cat_id=124484008,price,NULL))*avg(if (root_cat_id=124484008,price,NULL))  as price_ratio_124484008,
std(if (root_cat_id=124750013,price,NULL))*avg(if (root_cat_id=124750013,price,NULL))  as price_ratio_124750013,
std(if (root_cat_id=14,price,NULL))       *avg(if (root_cat_id=14,price,NULL))        as price_ratio_14,
std(if (root_cat_id=1512,price,NULL))     *avg(if (root_cat_id=1512,price,NULL))      as price_ratio_1512,
std(if (root_cat_id=16,price,NULL))       *avg(if (root_cat_id=16,price,NULL))        as price_ratio_16,
std(if (root_cat_id=1625,price,NULL))     *avg(if (root_cat_id=1625,price,NULL))      as price_ratio_1625,
std(if (root_cat_id=1801,price,NULL))     *avg(if (root_cat_id=1801,price,NULL))      as price_ratio_1801,
std(if (root_cat_id=20,price,NULL))       *avg(if (root_cat_id=20,price,NULL))        as price_ratio_20,
std(if (root_cat_id=21,price,NULL))       *avg(if (root_cat_id=21,price,NULL))        as price_ratio_21,
std(if (root_cat_id=23,price,NULL))       *avg(if (root_cat_id=23,price,NULL))        as price_ratio_23,
std(if (root_cat_id=25,price,NULL))       *avg(if (root_cat_id=25,price,NULL))        as price_ratio_25,
std(if (root_cat_id=26,price,NULL))       *avg(if (root_cat_id=26,price,NULL))        as price_ratio_26,
std(if (root_cat_id=27,price,NULL))       *avg(if (root_cat_id=27,price,NULL))        as price_ratio_27,
std(if (root_cat_id=28,price,NULL))       *avg(if (root_cat_id=28,price,NULL))        as price_ratio_28,
std(if (root_cat_id=2813,price,NULL))     *avg(if (root_cat_id=2813,price,NULL))      as price_ratio_2813,
std(if (root_cat_id=29,price,NULL))       *avg(if (root_cat_id=29,price,NULL))        as price_ratio_29,
std(if (root_cat_id=30,price,NULL))       *avg(if (root_cat_id=30,price,NULL))        as price_ratio_30,
std(if (root_cat_id=33,price,NULL))       *avg(if (root_cat_id=33,price,NULL))        as price_ratio_33,
std(if (root_cat_id=34,price,NULL))       *avg(if (root_cat_id=34,price,NULL))        as price_ratio_34,
std(if (root_cat_id=35,price,NULL))       *avg(if (root_cat_id=35,price,NULL))        as price_ratio_35,
std(if (root_cat_id=40,price,NULL))       *avg(if (root_cat_id=40,price,NULL))        as price_ratio_40,
std(if (root_cat_id=50002766,price,NULL)) *avg(if (root_cat_id=50002766,price,NULL))  as price_ratio_50002766,
std(if (root_cat_id=50002768,price,NULL)) *avg(if (root_cat_id=50002768,price,NULL))  as price_ratio_50002768,
std(if (root_cat_id=50004958,price,NULL)) *avg(if (root_cat_id=50004958,price,NULL))  as price_ratio_50004958,
std(if (root_cat_id=50006842,price,NULL)) *avg(if (root_cat_id=50006842,price,NULL))  as price_ratio_50006842,
std(if (root_cat_id=50006843,price,NULL)) *avg(if (root_cat_id=50006843,price,NULL))  as price_ratio_50006843,
std(if (root_cat_id=50007216,price,NULL)) *avg(if (root_cat_id=50007216,price,NULL))  as price_ratio_50007216,
std(if (root_cat_id=50007218,price,NULL)) *avg(if (root_cat_id=50007218,price,NULL))  as price_ratio_50007218,
std(if (root_cat_id=50008075,price,NULL)) *avg(if (root_cat_id=50008075,price,NULL))  as price_ratio_50008075,
std(if (root_cat_id=50008090,price,NULL)) *avg(if (root_cat_id=50008090,price,NULL))  as price_ratio_50008090,
std(if (root_cat_id=50008141,price,NULL)) *avg(if (root_cat_id=50008141,price,NULL))  as price_ratio_50008141,
std(if (root_cat_id=50008163,price,NULL)) *avg(if (root_cat_id=50008163,price,NULL))  as price_ratio_50008163,
std(if (root_cat_id=50008164,price,NULL)) *avg(if (root_cat_id=50008164,price,NULL))  as price_ratio_50008164,
std(if (root_cat_id=50008165,price,NULL)) *avg(if (root_cat_id=50008165,price,NULL))  as price_ratio_50008165,
std(if (root_cat_id=50008907,price,NULL)) *avg(if (root_cat_id=50008907,price,NULL))  as price_ratio_50008907,
std(if (root_cat_id=50010404,price,NULL)) *avg(if (root_cat_id=50010404,price,NULL))  as price_ratio_50010404,
std(if (root_cat_id=50010728,price,NULL)) *avg(if (root_cat_id=50010728,price,NULL))  as price_ratio_50010728,
std(if (root_cat_id=50010788,price,NULL)) *avg(if (root_cat_id=50010788,price,NULL))  as price_ratio_50010788,
std(if (root_cat_id=50011397,price,NULL)) *avg(if (root_cat_id=50011397,price,NULL))  as price_ratio_50011397,
std(if (root_cat_id=50011665,price,NULL)) *avg(if (root_cat_id=50011665,price,NULL))  as price_ratio_50011665,
std(if (root_cat_id=50011699,price,NULL)) *avg(if (root_cat_id=50011699,price,NULL))  as price_ratio_50011699,
std(if (root_cat_id=50011740,price,NULL)) *avg(if (root_cat_id=50011740,price,NULL))  as price_ratio_50011740,
std(if (root_cat_id=50011949,price,NULL)) *avg(if (root_cat_id=50011949,price,NULL))  as price_ratio_50011949,
std(if (root_cat_id=50011972,price,NULL)) *avg(if (root_cat_id=50011972,price,NULL))  as price_ratio_50011972,
std(if (root_cat_id=50012029,price,NULL)) *avg(if (root_cat_id=50012029,price,NULL))  as price_ratio_50012029,
std(if (root_cat_id=50012082,price,NULL)) *avg(if (root_cat_id=50012082,price,NULL))  as price_ratio_50012082,
std(if (root_cat_id=50012100,price,NULL)) *avg(if (root_cat_id=50012100,price,NULL))  as price_ratio_50012100,
std(if (root_cat_id=50012164,price,NULL)) *avg(if (root_cat_id=50012164,price,NULL))  as price_ratio_50012164,
std(if (root_cat_id=50013864,price,NULL)) *avg(if (root_cat_id=50013864,price,NULL))  as price_ratio_50013864,
std(if (root_cat_id=50013886,price,NULL)) *avg(if (root_cat_id=50013886,price,NULL))  as price_ratio_50013886,
std(if (root_cat_id=50014811,price,NULL)) *avg(if (root_cat_id=50014811,price,NULL))  as price_ratio_50014811,
std(if (root_cat_id=50014812,price,NULL)) *avg(if (root_cat_id=50014812,price,NULL))  as price_ratio_50014812,
std(if (root_cat_id=50014927,price,NULL)) *avg(if (root_cat_id=50014927,price,NULL))  as price_ratio_50014927,
std(if (root_cat_id=50016348,price,NULL)) *avg(if (root_cat_id=50016348,price,NULL))  as price_ratio_50016348,
std(if (root_cat_id=50016349,price,NULL)) *avg(if (root_cat_id=50016349,price,NULL))  as price_ratio_50016349,
std(if (root_cat_id=50016422,price,NULL)) *avg(if (root_cat_id=50016422,price,NULL))  as price_ratio_50016422,
std(if (root_cat_id=50016891,price,NULL)) *avg(if (root_cat_id=50016891,price,NULL))  as price_ratio_50016891,
std(if (root_cat_id=50017300,price,NULL)) *avg(if (root_cat_id=50017300,price,NULL))  as price_ratio_50017300,
std(if (root_cat_id=50018004,price,NULL)) *avg(if (root_cat_id=50018004,price,NULL))  as price_ratio_50018004,
std(if (root_cat_id=50018222,price,NULL)) *avg(if (root_cat_id=50018222,price,NULL))  as price_ratio_50018222,
std(if (root_cat_id=50018264,price,NULL)) *avg(if (root_cat_id=50018264,price,NULL))  as price_ratio_50018264,
std(if (root_cat_id=50019095,price,NULL)) *avg(if (root_cat_id=50019095,price,NULL))  as price_ratio_50019095,
std(if (root_cat_id=50019780,price,NULL)) *avg(if (root_cat_id=50019780,price,NULL))  as price_ratio_50019780,
std(if (root_cat_id=50020275,price,NULL)) *avg(if (root_cat_id=50020275,price,NULL))  as price_ratio_50020275,
std(if (root_cat_id=50020332,price,NULL)) *avg(if (root_cat_id=50020332,price,NULL))  as price_ratio_50020332,
std(if (root_cat_id=50020485,price,NULL)) *avg(if (root_cat_id=50020485,price,NULL))  as price_ratio_50020485,
std(if (root_cat_id=50020579,price,NULL)) *avg(if (root_cat_id=50020579,price,NULL))  as price_ratio_50020579,
std(if (root_cat_id=50020611,price,NULL)) *avg(if (root_cat_id=50020611,price,NULL))  as price_ratio_50020611,
std(if (root_cat_id=50020808,price,NULL)) *avg(if (root_cat_id=50020808,price,NULL))  as price_ratio_50020808,
std(if (root_cat_id=50020857,price,NULL)) *avg(if (root_cat_id=50020857,price,NULL))  as price_ratio_50020857,
std(if (root_cat_id=50022517,price,NULL)) *avg(if (root_cat_id=50022517,price,NULL))  as price_ratio_50022517,
std(if (root_cat_id=50022703,price,NULL)) *avg(if (root_cat_id=50022703,price,NULL))  as price_ratio_50022703,
std(if (root_cat_id=50023282,price,NULL)) *avg(if (root_cat_id=50023282,price,NULL))  as price_ratio_50023282,
std(if (root_cat_id=50023575,price,NULL)) *avg(if (root_cat_id=50023575,price,NULL))  as price_ratio_50023575,
std(if (root_cat_id=50023717,price,NULL)) *avg(if (root_cat_id=50023717,price,NULL))  as price_ratio_50023717,
std(if (root_cat_id=50023722,price,NULL)) *avg(if (root_cat_id=50023722,price,NULL))  as price_ratio_50023722,
std(if (root_cat_id=50023724,price,NULL)) *avg(if (root_cat_id=50023724,price,NULL))  as price_ratio_50023724,
std(if (root_cat_id=50023804,price,NULL)) *avg(if (root_cat_id=50023804,price,NULL))  as price_ratio_50023804,
std(if (root_cat_id=50023878,price,NULL)) *avg(if (root_cat_id=50023878,price,NULL))  as price_ratio_50023878,
std(if (root_cat_id=50023904,price,NULL)) *avg(if (root_cat_id=50023904,price,NULL))  as price_ratio_50023904,
std(if (root_cat_id=50024451,price,NULL)) *avg(if (root_cat_id=50024451,price,NULL))  as price_ratio_50024451,
std(if (root_cat_id=50024612,price,NULL)) *avg(if (root_cat_id=50024612,price,NULL))  as price_ratio_50024612,
std(if (root_cat_id=50024971,price,NULL)) *avg(if (root_cat_id=50024971,price,NULL))  as price_ratio_50024971,
std(if (root_cat_id=50025004,price,NULL)) *avg(if (root_cat_id=50025004,price,NULL))  as price_ratio_50025004,
std(if (root_cat_id=50025110,price,NULL)) *avg(if (root_cat_id=50025110,price,NULL))  as price_ratio_50025110,
std(if (root_cat_id=50025111,price,NULL)) *avg(if (root_cat_id=50025111,price,NULL))  as price_ratio_50025111,
std(if (root_cat_id=50025705,price,NULL)) *avg(if (root_cat_id=50025705,price,NULL))  as price_ratio_50025705,
std(if (root_cat_id=50025707,price,NULL)) *avg(if (root_cat_id=50025707,price,NULL))  as price_ratio_50025707,
std(if (root_cat_id=50026316,price,NULL)) *avg(if (root_cat_id=50026316,price,NULL))  as price_ratio_50026316,
std(if (root_cat_id=50026523,price,NULL)) *avg(if (root_cat_id=50026523,price,NULL))  as price_ratio_50026523,
std(if (root_cat_id=50026555,price,NULL)) *avg(if (root_cat_id=50026555,price,NULL))  as price_ratio_50026555,
std(if (root_cat_id=50026800,price,NULL)) *avg(if (root_cat_id=50026800,price,NULL))  as price_ratio_50026800,
std(if (root_cat_id=50050359,price,NULL)) *avg(if (root_cat_id=50050359,price,NULL))  as price_ratio_50050359,
std(if (root_cat_id=50050471,price,NULL)) *avg(if (root_cat_id=50050471,price,NULL))  as price_ratio_50050471,
std(if (root_cat_id=50074001,price,NULL)) *avg(if (root_cat_id=50074001,price,NULL))  as price_ratio_50074001,
std(if (root_cat_id=50158001,price,NULL)) *avg(if (root_cat_id=50158001,price,NULL))  as price_ratio_50158001,
std(if (root_cat_id=50454031,price,NULL)) *avg(if (root_cat_id=50454031,price,NULL))  as price_ratio_50454031,
std(if (root_cat_id=50468001,price,NULL)) *avg(if (root_cat_id=50468001,price,NULL))  as price_ratio_50468001,
std(if (root_cat_id=50510002,price,NULL)) *avg(if (root_cat_id=50510002,price,NULL))  as price_ratio_50510002,
std(if (root_cat_id=99,price,NULL))       *avg(if (root_cat_id=99,price,NULL))        as price_ratio_99
from wlservice.t_zlj_tmp_rong360_1w_record
where rn<4 and price<59999
group by tel;


drop table wlservice.t_wrt_model_rong360_month_tmp1;
create table wlservice.t_wrt_model_rong360_month_tmp1 as
select
tel,substr(dsn,1,6) as month,count(*) as cnt,sum(price) as price
from wlservice.t_zlj_tmp_rong360_1w_record 
where rn<4 and price<59999 and dsn>'20160700'
group by tel,substr(dsn,1,6) ;


drop table wlservice.t_wrt_model_rong360_month_std;
create table wlservice.t_wrt_model_rong360_month_std as
select
tel,
count(*) as buy_month,
avg(cnt) as avg_cnt,
std(cnt) as std_cnt,
avg(price) as avg_price,
std(price) as std_price
from wlservice.t_wrt_model_rong360_month_tmp1
group by tel;


drop table wlservice.t_wrt_model_rong360_finnal;
create table wlservice.t_wrt_model_rong360_finnal as
SELECT
a.tel,
a.avg_price_ratio,
a.std_price_ratio,
round(b.cnt_ratio_11,4) as cnt_ratio_11,
round(b.cnt_ratio_1101,4) as cnt_ratio_1101,
round(b.cnt_ratio_1201,4) as cnt_ratio_1201,
round(b.cnt_ratio_120886001,4) as cnt_ratio_120886001,
round(b.cnt_ratio_120950002,4) as cnt_ratio_120950002,
round(b.cnt_ratio_121266001,4) as cnt_ratio_121266001,
round(b.cnt_ratio_121536003,4) as cnt_ratio_121536003,
round(b.cnt_ratio_121536007,4) as cnt_ratio_121536007,
round(b.cnt_ratio_122650005,4) as cnt_ratio_122650005,
round(b.cnt_ratio_122684003,4) as cnt_ratio_122684003,
round(b.cnt_ratio_122718004,4) as cnt_ratio_122718004,
round(b.cnt_ratio_122852001,4) as cnt_ratio_122852001,
round(b.cnt_ratio_122928002,4) as cnt_ratio_122928002,
round(b.cnt_ratio_122950001,4) as cnt_ratio_122950001,
round(b.cnt_ratio_122952001,4) as cnt_ratio_122952001,
round(b.cnt_ratio_124024001,4) as cnt_ratio_124024001,
round(b.cnt_ratio_124044001,4) as cnt_ratio_124044001,
round(b.cnt_ratio_124050001,4) as cnt_ratio_124050001,
round(b.cnt_ratio_124242008,4) as cnt_ratio_124242008,
round(b.cnt_ratio_124354002,4) as cnt_ratio_124354002,
round(b.cnt_ratio_124458005,4) as cnt_ratio_124458005,
round(b.cnt_ratio_124466001,4) as cnt_ratio_124466001,
round(b.cnt_ratio_124468001,4) as cnt_ratio_124468001,
round(b.cnt_ratio_124470001,4) as cnt_ratio_124470001,
round(b.cnt_ratio_124484008,4) as cnt_ratio_124484008,
round(b.cnt_ratio_124750013,4) as cnt_ratio_124750013,
round(b.cnt_ratio_14,4) as cnt_ratio_14,
round(b.cnt_ratio_1512,4) as cnt_ratio_1512,
round(b.cnt_ratio_16,4) as cnt_ratio_16,
round(b.cnt_ratio_1625,4) as cnt_ratio_1625,
round(b.cnt_ratio_1801,4) as cnt_ratio_1801,
round(b.cnt_ratio_20,4) as cnt_ratio_20,
round(b.cnt_ratio_21,4) as cnt_ratio_21,
round(b.cnt_ratio_23,4) as cnt_ratio_23,
round(b.cnt_ratio_25,4) as cnt_ratio_25,
round(b.cnt_ratio_26,4) as cnt_ratio_26,
round(b.cnt_ratio_27,4) as cnt_ratio_27,
round(b.cnt_ratio_28,4) as cnt_ratio_28,
round(b.cnt_ratio_2813,4) as cnt_ratio_2813,
round(b.cnt_ratio_29,4) as cnt_ratio_29,
round(b.cnt_ratio_30,4) as cnt_ratio_30,
round(b.cnt_ratio_33,4) as cnt_ratio_33,
round(b.cnt_ratio_34,4) as cnt_ratio_34,
round(b.cnt_ratio_35,4) as cnt_ratio_35,
round(b.cnt_ratio_40,4) as cnt_ratio_40,
round(b.cnt_ratio_50002766,4) as cnt_ratio_50002766,
round(b.cnt_ratio_50002768,4) as cnt_ratio_50002768,
round(b.cnt_ratio_50004958,4) as cnt_ratio_50004958,
round(b.cnt_ratio_50006842,4) as cnt_ratio_50006842,
round(b.cnt_ratio_50006843,4) as cnt_ratio_50006843,
round(b.cnt_ratio_50007216,4) as cnt_ratio_50007216,
round(b.cnt_ratio_50007218,4) as cnt_ratio_50007218,
round(b.cnt_ratio_50008075,4) as cnt_ratio_50008075,
round(b.cnt_ratio_50008090,4) as cnt_ratio_50008090,
round(b.cnt_ratio_50008141,4) as cnt_ratio_50008141,
round(b.cnt_ratio_50008163,4) as cnt_ratio_50008163,
round(b.cnt_ratio_50008164,4) as cnt_ratio_50008164,
round(b.cnt_ratio_50008165,4) as cnt_ratio_50008165,
round(b.cnt_ratio_50008907,4) as cnt_ratio_50008907,
round(b.cnt_ratio_50010404,4) as cnt_ratio_50010404,
round(b.cnt_ratio_50010728,4) as cnt_ratio_50010728,
round(b.cnt_ratio_50010788,4) as cnt_ratio_50010788,
round(b.cnt_ratio_50011397,4) as cnt_ratio_50011397,
round(b.cnt_ratio_50011665,4) as cnt_ratio_50011665,
round(b.cnt_ratio_50011699,4) as cnt_ratio_50011699,
round(b.cnt_ratio_50011740,4) as cnt_ratio_50011740,
round(b.cnt_ratio_50011949,4) as cnt_ratio_50011949,
round(b.cnt_ratio_50011972,4) as cnt_ratio_50011972,
round(b.cnt_ratio_50012029,4) as cnt_ratio_50012029,
round(b.cnt_ratio_50012082,4) as cnt_ratio_50012082,
round(b.cnt_ratio_50012100,4) as cnt_ratio_50012100,
round(b.cnt_ratio_50012164,4) as cnt_ratio_50012164,
round(b.cnt_ratio_50013864,4) as cnt_ratio_50013864,
round(b.cnt_ratio_50013886,4) as cnt_ratio_50013886,
round(b.cnt_ratio_50014811,4) as cnt_ratio_50014811,
round(b.cnt_ratio_50014812,4) as cnt_ratio_50014812,
round(b.cnt_ratio_50014927,4) as cnt_ratio_50014927,
round(b.cnt_ratio_50016348,4) as cnt_ratio_50016348,
round(b.cnt_ratio_50016349,4) as cnt_ratio_50016349,
round(b.cnt_ratio_50016422,4) as cnt_ratio_50016422,
round(b.cnt_ratio_50016891,4) as cnt_ratio_50016891,
round(b.cnt_ratio_50017300,4) as cnt_ratio_50017300,
round(b.cnt_ratio_50018004,4) as cnt_ratio_50018004,
round(b.cnt_ratio_50018222,4) as cnt_ratio_50018222,
round(b.cnt_ratio_50018264,4) as cnt_ratio_50018264,
round(b.cnt_ratio_50019095,4) as cnt_ratio_50019095,
round(b.cnt_ratio_50019780,4) as cnt_ratio_50019780,
round(b.cnt_ratio_50020275,4) as cnt_ratio_50020275,
round(b.cnt_ratio_50020332,4) as cnt_ratio_50020332,
round(b.cnt_ratio_50020485,4) as cnt_ratio_50020485,
round(b.cnt_ratio_50020579,4) as cnt_ratio_50020579,
round(b.cnt_ratio_50020611,4) as cnt_ratio_50020611,
round(b.cnt_ratio_50020808,4) as cnt_ratio_50020808,
round(b.cnt_ratio_50020857,4) as cnt_ratio_50020857,
round(b.cnt_ratio_50022517,4) as cnt_ratio_50022517,
round(b.cnt_ratio_50022703,4) as cnt_ratio_50022703,
round(b.cnt_ratio_50023282,4) as cnt_ratio_50023282,
round(b.cnt_ratio_50023575,4) as cnt_ratio_50023575,
round(b.cnt_ratio_50023717,4) as cnt_ratio_50023717,
round(b.cnt_ratio_50023722,4) as cnt_ratio_50023722,
round(b.cnt_ratio_50023724,4) as cnt_ratio_50023724,
round(b.cnt_ratio_50023804,4) as cnt_ratio_50023804,
round(b.cnt_ratio_50023878,4) as cnt_ratio_50023878,
round(b.cnt_ratio_50023904,4) as cnt_ratio_50023904,
round(b.cnt_ratio_50024451,4) as cnt_ratio_50024451,
round(b.cnt_ratio_50024612,4) as cnt_ratio_50024612,
round(b.cnt_ratio_50024971,4) as cnt_ratio_50024971,
round(b.cnt_ratio_50025004,4) as cnt_ratio_50025004,
round(b.cnt_ratio_50025110,4) as cnt_ratio_50025110,
round(b.cnt_ratio_50025111,4) as cnt_ratio_50025111,
round(b.cnt_ratio_50025705,4) as cnt_ratio_50025705,
round(b.cnt_ratio_50025707,4) as cnt_ratio_50025707,
round(b.cnt_ratio_50026316,4) as cnt_ratio_50026316,
round(b.cnt_ratio_50026523,4) as cnt_ratio_50026523,
round(b.cnt_ratio_50026555,4) as cnt_ratio_50026555,
round(b.cnt_ratio_50026800,4) as cnt_ratio_50026800,
round(b.cnt_ratio_50050359,4) as cnt_ratio_50050359,
round(b.cnt_ratio_50050471,4) as cnt_ratio_50050471,
round(b.cnt_ratio_50074001,4) as cnt_ratio_50074001,
round(b.cnt_ratio_50158001,4) as cnt_ratio_50158001,
round(b.cnt_ratio_50454031,4) as cnt_ratio_50454031,
round(b.cnt_ratio_50468001,4) as cnt_ratio_50468001,
round(b.cnt_ratio_50510002,4) as cnt_ratio_50510002,
round(b.cnt_ratio_99,4) as cnt_ratio_99,
round(c.price_ratio_11,4) as price_ratio_11,
round(c.price_ratio_1101,4) as price_ratio_1101,
round(c.price_ratio_1201,4) as price_ratio_1201,
round(c.price_ratio_120886001,4) as price_ratio_120886001,
round(c.price_ratio_120950002,4) as price_ratio_120950002,
round(c.price_ratio_121266001,4) as price_ratio_121266001,
round(c.price_ratio_121536003,4) as price_ratio_121536003,
round(c.price_ratio_121536007,4) as price_ratio_121536007,
round(c.price_ratio_122650005,4) as price_ratio_122650005,
round(c.price_ratio_122684003,4) as price_ratio_122684003,
round(c.price_ratio_122718004,4) as price_ratio_122718004,
round(c.price_ratio_122852001,4) as price_ratio_122852001,
round(c.price_ratio_122928002,4) as price_ratio_122928002,
round(c.price_ratio_122950001,4) as price_ratio_122950001,
round(c.price_ratio_122952001,4) as price_ratio_122952001,
round(c.price_ratio_124024001,4) as price_ratio_124024001,
round(c.price_ratio_124044001,4) as price_ratio_124044001,
round(c.price_ratio_124050001,4) as price_ratio_124050001,
round(c.price_ratio_124242008,4) as price_ratio_124242008,
round(c.price_ratio_124354002,4) as price_ratio_124354002,
round(c.price_ratio_124458005,4) as price_ratio_124458005,
round(c.price_ratio_124466001,4) as price_ratio_124466001,
round(c.price_ratio_124468001,4) as price_ratio_124468001,
round(c.price_ratio_124470001,4) as price_ratio_124470001,
round(c.price_ratio_124484008,4) as price_ratio_124484008,
round(c.price_ratio_124750013,4) as price_ratio_124750013,
round(c.price_ratio_14,4) as price_ratio_14,
round(c.price_ratio_1512,4) as price_ratio_1512,
round(c.price_ratio_16,4) as price_ratio_16,
round(c.price_ratio_1625,4) as price_ratio_1625,
round(c.price_ratio_1801,4) as price_ratio_1801,
round(c.price_ratio_20,4) as price_ratio_20,
round(c.price_ratio_21,4) as price_ratio_21,
round(c.price_ratio_23,4) as price_ratio_23,
round(c.price_ratio_25,4) as price_ratio_25,
round(c.price_ratio_26,4) as price_ratio_26,
round(c.price_ratio_27,4) as price_ratio_27,
round(c.price_ratio_28,4) as price_ratio_28,
round(c.price_ratio_2813,4) as price_ratio_2813,
round(c.price_ratio_29,4) as price_ratio_29,
round(c.price_ratio_30,4) as price_ratio_30,
round(c.price_ratio_33,4) as price_ratio_33,
round(c.price_ratio_34,4) as price_ratio_34,
round(c.price_ratio_35,4) as price_ratio_35,
round(c.price_ratio_40,4) as price_ratio_40,
round(c.price_ratio_50002766,4) as price_ratio_50002766,
round(c.price_ratio_50002768,4) as price_ratio_50002768,
round(c.price_ratio_50004958,4) as price_ratio_50004958,
round(c.price_ratio_50006842,4) as price_ratio_50006842,
round(c.price_ratio_50006843,4) as price_ratio_50006843,
round(c.price_ratio_50007216,4) as price_ratio_50007216,
round(c.price_ratio_50007218,4) as price_ratio_50007218,
round(c.price_ratio_50008075,4) as price_ratio_50008075,
round(c.price_ratio_50008090,4) as price_ratio_50008090,
round(c.price_ratio_50008141,4) as price_ratio_50008141,
round(c.price_ratio_50008163,4) as price_ratio_50008163,
round(c.price_ratio_50008164,4) as price_ratio_50008164,
round(c.price_ratio_50008165,4) as price_ratio_50008165,
round(c.price_ratio_50008907,4) as price_ratio_50008907,
round(c.price_ratio_50010404,4) as price_ratio_50010404,
round(c.price_ratio_50010728,4) as price_ratio_50010728,
round(c.price_ratio_50010788,4) as price_ratio_50010788,
round(c.price_ratio_50011397,4) as price_ratio_50011397,
round(c.price_ratio_50011665,4) as price_ratio_50011665,
round(c.price_ratio_50011699,4) as price_ratio_50011699,
round(c.price_ratio_50011740,4) as price_ratio_50011740,
round(c.price_ratio_50011949,4) as price_ratio_50011949,
round(c.price_ratio_50011972,4) as price_ratio_50011972,
round(c.price_ratio_50012029,4) as price_ratio_50012029,
round(c.price_ratio_50012082,4) as price_ratio_50012082,
round(c.price_ratio_50012100,4) as price_ratio_50012100,
round(c.price_ratio_50012164,4) as price_ratio_50012164,
round(c.price_ratio_50013864,4) as price_ratio_50013864,
round(c.price_ratio_50013886,4) as price_ratio_50013886,
round(c.price_ratio_50014811,4) as price_ratio_50014811,
round(c.price_ratio_50014812,4) as price_ratio_50014812,
round(c.price_ratio_50014927,4) as price_ratio_50014927,
round(c.price_ratio_50016348,4) as price_ratio_50016348,
round(c.price_ratio_50016349,4) as price_ratio_50016349,
round(c.price_ratio_50016422,4) as price_ratio_50016422,
round(c.price_ratio_50016891,4) as price_ratio_50016891,
round(c.price_ratio_50017300,4) as price_ratio_50017300,
round(c.price_ratio_50018004,4) as price_ratio_50018004,
round(c.price_ratio_50018222,4) as price_ratio_50018222,
round(c.price_ratio_50018264,4) as price_ratio_50018264,
round(c.price_ratio_50019095,4) as price_ratio_50019095,
round(c.price_ratio_50019780,4) as price_ratio_50019780,
round(c.price_ratio_50020275,4) as price_ratio_50020275,
round(c.price_ratio_50020332,4) as price_ratio_50020332,
round(c.price_ratio_50020485,4) as price_ratio_50020485,
round(c.price_ratio_50020579,4) as price_ratio_50020579,
round(c.price_ratio_50020611,4) as price_ratio_50020611,
round(c.price_ratio_50020808,4) as price_ratio_50020808,
round(c.price_ratio_50020857,4) as price_ratio_50020857,
round(c.price_ratio_50022517,4) as price_ratio_50022517,
round(c.price_ratio_50022703,4) as price_ratio_50022703,
round(c.price_ratio_50023282,4) as price_ratio_50023282,
round(c.price_ratio_50023575,4) as price_ratio_50023575,
round(c.price_ratio_50023717,4) as price_ratio_50023717,
round(c.price_ratio_50023722,4) as price_ratio_50023722,
round(c.price_ratio_50023724,4) as price_ratio_50023724,
round(c.price_ratio_50023804,4) as price_ratio_50023804,
round(c.price_ratio_50023878,4) as price_ratio_50023878,
round(c.price_ratio_50023904,4) as price_ratio_50023904,
round(c.price_ratio_50024451,4) as price_ratio_50024451,
round(c.price_ratio_50024612,4) as price_ratio_50024612,
round(c.price_ratio_50024971,4) as price_ratio_50024971,
round(c.price_ratio_50025004,4) as price_ratio_50025004,
round(c.price_ratio_50025110,4) as price_ratio_50025110,
round(c.price_ratio_50025111,4) as price_ratio_50025111,
round(c.price_ratio_50025705,4) as price_ratio_50025705,
round(c.price_ratio_50025707,4) as price_ratio_50025707,
round(c.price_ratio_50026316,4) as price_ratio_50026316,
round(c.price_ratio_50026523,4) as price_ratio_50026523,
round(c.price_ratio_50026555,4) as price_ratio_50026555,
round(c.price_ratio_50026800,4) as price_ratio_50026800,
round(c.price_ratio_50050359,4) as price_ratio_50050359,
round(c.price_ratio_50050471,4) as price_ratio_50050471,
round(c.price_ratio_50074001,4) as price_ratio_50074001,
round(c.price_ratio_50158001,4) as price_ratio_50158001,
round(c.price_ratio_50454031,4) as price_ratio_50454031,
round(c.price_ratio_50468001,4) as price_ratio_50468001,
round(c.price_ratio_50510002,4) as price_ratio_50510002,
round(c.price_ratio_99,4) as price_ratio_99,
d.buy_month,
d.avg_cnt,
d.std_cnt,
d.avg_price,
d.std_price
from  wlservice.t_wrt_model_rong360_purchase_power a
left join wlservice.t_wrt_model_rong360_cnt_raio b on a.tel=b.tel
left join wlservice.t_wrt_model_rong360_price_raio c on a.tel=c.tel
left join wlservice.t_wrt_model_rong360_month_std d on a.tel=d.tel;


DROP  table wlservice.t_base_ec_record_dev_new_rong360_feature_wrt ;
create table  wlservice.t_base_ec_record_dev_new_rong360_feature_wrt as
SELECT
tel,
max(user_id) as user_id ,
COUNT(1) as local_buycount ,
sum(price) as total_price,
sum( case when root_cat_id IN  ( 26, 50016768, 50024971, 124470006  ) then 1 else 0 end) as car_flag ,
sum( case when root_cat_id IN  ( 27,  50008164,50020332,50020808, 50022649,50022703, 50022987,50023804,50025881, 122852001,123302001,124698018  ) then 1 else 0 end)
as house_flag ,
sum( case when root_cat_id IN  (25 ,50008165,122650005  ) then 1 else 0 end) as child_flag ,
sum( case when root_cat_id IN  (29 ) then 1 else 0 end) as pet_flag ,
  sum(CASE WHEN annoy = '1'       THEN 1        ELSE 0 END)     as        annoy_num,
  sum(CASE WHEN annoy = '1'       THEN 1        ELSE 0 END)/COUNT(1) as  annoy_ratio,
   COUNT(DISTINCT brand_id)  as  brand_id_num,
   COUNT(DISTINCT root_cat_id) as root_cat_id_num,
   sum(CASE WHEN bc_type = 'B'       THEN 1         ELSE 0 END)       as          b_bc_type_num,
   sum(CASE WHEN bc_type = 'B'       THEN 1         ELSE 0 END)/COUNT(1)      as     b_bc_type_num_ratio,
   sum(CASE WHEN bc_type = 'B'       THEN price         ELSE 0 END)/sum(price)   as  b_bc_price_ratio,
   sum(CASE WHEN CAST (brand_id as bigint )>10       THEN price         ELSE 0 END)/sum(price)  as  brand_effec_price_ratio,
   sum(CASE WHEN CAST (brand_id as bigint )>10     THEN 1        ELSE 0 END)/COUNT(1)    as        brand_effec_num_ratio,
   sum(case when price <=50 then 1 else 0 end)/count(*) as b50_num_ratio,
   sum(case when price <=50 then price else 0 end)/sum(price ) as b50_ratio,
      sum(case when price <=30 then 1 else 0 end)/count(*) as b30_num_ratio,
   sum(case when price <=30 then price else 0 end)/sum(price ) as b30_ratio,
      sum(case when price <=10 then 1 else 0 end)/count(*) as b10_num_ratio,
   sum(case when price <=10 then price else 0 end)/sum(price ) as b10_ratio,
      sum(case when price <=5 then 1 else 0 end)/count(*) as b5_num_ratio,
   sum(case when price <=5 then price else 0 end)/sum(price ) as b5_ratio,
   (sum(pow(2.8, datediff* (-0.005)))+20)/75  as active_score
from wlservice.t_zlj_tmp_rong360_1w_record  where rn<4 and price<59999
group by tel
;

drop table wlservice.t_rong360_model_features_20161216; --去掉偏好
create table wlservice.t_rong360_model_features_20161216 as
SELECT
t1.tel,
t1.buy_month,
t1.avg_cnt,
t1.std_cnt,
t1.avg_price,
t1.std_price,
t1.avg_price_ratio,
t1.std_price_ratio,
t1.cnt_ratio_11,
t1.cnt_ratio_1101,
t1.cnt_ratio_1201,
t1.cnt_ratio_120886001,
t1.cnt_ratio_120950002,
t1.cnt_ratio_121266001,
t1.cnt_ratio_121536003,
t1.cnt_ratio_121536007,
t1.cnt_ratio_122650005,
t1.cnt_ratio_122684003,
t1.cnt_ratio_122718004,
t1.cnt_ratio_122852001,
t1.cnt_ratio_122928002,
t1.cnt_ratio_122950001,
t1.cnt_ratio_122952001,
t1.cnt_ratio_124024001,
t1.cnt_ratio_124044001,
t1.cnt_ratio_124050001,
t1.cnt_ratio_124242008,
t1.cnt_ratio_124354002,
t1.cnt_ratio_124458005,
t1.cnt_ratio_124466001,
t1.cnt_ratio_124468001,
t1.cnt_ratio_124470001,
t1.cnt_ratio_124484008,
t1.cnt_ratio_124750013,
t1.cnt_ratio_14,
t1.cnt_ratio_1512,
t1.cnt_ratio_16,
t1.cnt_ratio_1625,
t1.cnt_ratio_1801,
t1.cnt_ratio_20,
t1.cnt_ratio_21,
t1.cnt_ratio_23,
t1.cnt_ratio_25,
t1.cnt_ratio_26,
t1.cnt_ratio_27,
t1.cnt_ratio_28,
t1.cnt_ratio_2813,
t1.cnt_ratio_29,
t1.cnt_ratio_30,
t1.cnt_ratio_33,
t1.cnt_ratio_34,
t1.cnt_ratio_35,
t1.cnt_ratio_40,
t1.cnt_ratio_50002766,
t1.cnt_ratio_50002768,
t1.cnt_ratio_50004958,
t1.cnt_ratio_50006842,
t1.cnt_ratio_50006843,
t1.cnt_ratio_50007216,
t1.cnt_ratio_50007218,
t1.cnt_ratio_50008075,
t1.cnt_ratio_50008090,
t1.cnt_ratio_50008141,
t1.cnt_ratio_50008163,
t1.cnt_ratio_50008164,
t1.cnt_ratio_50008165,
t1.cnt_ratio_50008907,
t1.cnt_ratio_50010404,
t1.cnt_ratio_50010728,
t1.cnt_ratio_50010788,
t1.cnt_ratio_50011397,
t1.cnt_ratio_50011665,
t1.cnt_ratio_50011699,
t1.cnt_ratio_50011740,
t1.cnt_ratio_50011949,
t1.cnt_ratio_50011972,
t1.cnt_ratio_50012029,
t1.cnt_ratio_50012082,
t1.cnt_ratio_50012100,
t1.cnt_ratio_50012164,
t1.cnt_ratio_50013864,
t1.cnt_ratio_50013886,
t1.cnt_ratio_50014811,
t1.cnt_ratio_50014812,
t1.cnt_ratio_50014927,
t1.cnt_ratio_50016348,
t1.cnt_ratio_50016349,
t1.cnt_ratio_50016422,
t1.cnt_ratio_50016891,
t1.cnt_ratio_50017300,
t1.cnt_ratio_50018004,
t1.cnt_ratio_50018222,
t1.cnt_ratio_50018264,
t1.cnt_ratio_50019095,
t1.cnt_ratio_50019780,
t1.cnt_ratio_50020275,
t1.cnt_ratio_50020332,
t1.cnt_ratio_50020485,
t1.cnt_ratio_50020579,
t1.cnt_ratio_50020611,
t1.cnt_ratio_50020808,
t1.cnt_ratio_50020857,
t1.cnt_ratio_50022517,
t1.cnt_ratio_50022703,
t1.cnt_ratio_50023282,
t1.cnt_ratio_50023575,
t1.cnt_ratio_50023717,
t1.cnt_ratio_50023722,
t1.cnt_ratio_50023724,
t1.cnt_ratio_50023804,
t1.cnt_ratio_50023878,
t1.cnt_ratio_50023904,
t1.cnt_ratio_50024451,
t1.cnt_ratio_50024612,
t1.cnt_ratio_50024971,
t1.cnt_ratio_50025004,
t1.cnt_ratio_50025110,
t1.cnt_ratio_50025111,
t1.cnt_ratio_50025705,
t1.cnt_ratio_50025707,
t1.cnt_ratio_50026316,
t1.cnt_ratio_50026523,
t1.cnt_ratio_50026555,
t1.cnt_ratio_50026800,
t1.cnt_ratio_50050359,
t1.cnt_ratio_50050471,
t1.cnt_ratio_50074001,
t1.cnt_ratio_50158001,
t1.cnt_ratio_50454031,
t1.cnt_ratio_50468001,
t1.cnt_ratio_50510002,
t1.cnt_ratio_99,
t1.price_ratio_11,
t1.price_ratio_1101,
t1.price_ratio_1201,
t1.price_ratio_120886001,
t1.price_ratio_120950002,
t1.price_ratio_121266001,
t1.price_ratio_121536003,
t1.price_ratio_121536007,
t1.price_ratio_122650005,
t1.price_ratio_122684003,
t1.price_ratio_122718004,
t1.price_ratio_122852001,
t1.price_ratio_122928002,
t1.price_ratio_122950001,
t1.price_ratio_122952001,
t1.price_ratio_124024001,
t1.price_ratio_124044001,
t1.price_ratio_124050001,
t1.price_ratio_124242008,
t1.price_ratio_124354002,
t1.price_ratio_124458005,
t1.price_ratio_124466001,
t1.price_ratio_124468001,
t1.price_ratio_124470001,
t1.price_ratio_124484008,
t1.price_ratio_124750013,
t1.price_ratio_14,
t1.price_ratio_1512,
t1.price_ratio_16,
t1.price_ratio_1625,
t1.price_ratio_1801,
t1.price_ratio_20,
t1.price_ratio_21,
t1.price_ratio_23,
t1.price_ratio_25,
t1.price_ratio_26,
t1.price_ratio_27,
t1.price_ratio_28,
t1.price_ratio_2813,
t1.price_ratio_29,
t1.price_ratio_30,
t1.price_ratio_33,
t1.price_ratio_34,
t1.price_ratio_35,
t1.price_ratio_40,
t1.price_ratio_50002766,
t1.price_ratio_50002768,
t1.price_ratio_50004958,
t1.price_ratio_50006842,
t1.price_ratio_50006843,
t1.price_ratio_50007216,
t1.price_ratio_50007218,
t1.price_ratio_50008075,
t1.price_ratio_50008090,
t1.price_ratio_50008141,
t1.price_ratio_50008163,
t1.price_ratio_50008164,
t1.price_ratio_50008165,
t1.price_ratio_50008907,
t1.price_ratio_50010404,
t1.price_ratio_50010728,
t1.price_ratio_50010788,
t1.price_ratio_50011397,
t1.price_ratio_50011665,
t1.price_ratio_50011699,
t1.price_ratio_50011740,
t1.price_ratio_50011949,
t1.price_ratio_50011972,
t1.price_ratio_50012029,
t1.price_ratio_50012082,
t1.price_ratio_50012100,
t1.price_ratio_50012164,
t1.price_ratio_50013864,
t1.price_ratio_50013886,
t1.price_ratio_50014811,
t1.price_ratio_50014812,
t1.price_ratio_50014927,
t1.price_ratio_50016348,
t1.price_ratio_50016349,
t1.price_ratio_50016422,
t1.price_ratio_50016891,
t1.price_ratio_50017300,
t1.price_ratio_50018004,
t1.price_ratio_50018222,
t1.price_ratio_50018264,
t1.price_ratio_50019095,
t1.price_ratio_50019780,
t1.price_ratio_50020275,
t1.price_ratio_50020332,
t1.price_ratio_50020485,
t1.price_ratio_50020579,
t1.price_ratio_50020611,
t1.price_ratio_50020808,
t1.price_ratio_50020857,
t1.price_ratio_50022517,
t1.price_ratio_50022703,
t1.price_ratio_50023282,
t1.price_ratio_50023575,
t1.price_ratio_50023717,
t1.price_ratio_50023722,
t1.price_ratio_50023724,
t1.price_ratio_50023804,
t1.price_ratio_50023878,
t1.price_ratio_50023904,
t1.price_ratio_50024451,
t1.price_ratio_50024612,
t1.price_ratio_50024971,
t1.price_ratio_50025004,
t1.price_ratio_50025110,
t1.price_ratio_50025111,
t1.price_ratio_50025705,
t1.price_ratio_50025707,
t1.price_ratio_50026316,
t1.price_ratio_50026523,
t1.price_ratio_50026555,
t1.price_ratio_50026800,
t1.price_ratio_50050359,
t1.price_ratio_50050471,
t1.price_ratio_50074001,
t1.price_ratio_50158001,
t1.price_ratio_50454031,
t1.price_ratio_50468001,
t1.price_ratio_50510002,
t1.price_ratio_99,
t2.local_buycount          ,
t2.total_price             ,
t2.car_flag                ,
t2.house_flag              ,
t2.child_flag              ,
t2.pet_flag                ,
t2.annoy_num               ,
t2.annoy_ratio             ,
t2.brand_id_num            ,
t2.root_cat_id_num         ,
t2.b_bc_type_num           ,
t2.b_bc_type_num_ratio     ,
t2.b_bc_price_ratio        ,
t2.brand_effec_price_ratio ,
t2.brand_effec_num_ratio   ,
t2.b50_num_ratio           ,
t2.b50_ratio               ,
t2.b30_num_ratio           ,
t2.b30_ratio               ,
t2.b10_num_ratio           ,
t2.b10_ratio               ,
t2.b5_num_ratio            ,
t2.b5_ratio                ,
t2.active_score
from
wlservice.t_wrt_model_rong360_finnal t1
join
wlservice.t_base_ec_record_dev_new_rong360_feature_wrt t2
ON
t1.tel = t2.tel;

EOF

